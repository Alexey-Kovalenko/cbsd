#!/usr/local/bin/cbsd
#v11.1.17
globalconf="${workdir}/cbsd.conf";
MYARG="bname jname"
MYOPTARG=""
MYDESC="Move bhyve to jail"
CBSDMODULE="jail"

. ${subr}
. ${strings}
. ${tools}

init $*

. ${jrcconf}

[ $? -eq 1 ] && err 1 "${MAGENTA}No such jail: ${GREEN}${jname}${NORMAL}"

jdata="${data}"					# jail data path
jpath="${path}"					# jail path
bdata="${jaildatadir}/${bname}-data/"		# bhyve data path

[ ! -d ${jpath}/usr/local/cbsd ] && /bin/mkdir -p ${jdata}/usr/local/cbsd	# nullfs mount point
/sbin/mount -oro -t nullfs /usr/local/cbsd ${jdata}/usr/local/cbsd		# we need this for bhyve firmwares

[ ! -d ${jpath}/usr/local/jails-data ] && /bin/mkdir -p ${jpath}/usr/local/jails-data
[ ! -d ${jdata}/usr/local/jails-data/${bname}-data ] && /bin/mkdir -p ${jdata}/usr/local/jails-data/${bname}-data
/bin/cp -a ${bdata}/* ${jpath}/usr/local/jails-data/${bname}-data/

