#!/bin/sh

workdir=0
. cbsd.conf

GIT="echo"

case $1 in
	bump)
		# check if version contain "a" postfix
		[[ $myversion == *"a" ]] || exit 1
		# remove "a" postfix
		newversion=${myversion[@]//a/}
		# change version in files
		sed -i '' "s/myversion.*/myversion=\"${newversion}\"/" cbsd.conf
		sed -i '' "s/VERSION.*/VERSION \"${newversion}\"/" bin/cbsdsh/about.h
		echo ${newversion}
		${GIT} add cbsd.conf bin/cbsdsh/about.h
		${GIT} commit -m "${newversion}"
		# stuff from https://redmine.convectix.com/projects/cloud/wiki/Cbsd_git_github
		${GIT} checkout -b ${newversion}
		${GIT} push --set-upstream origin ${newversion}
		${GIT} tag -a "v${newversion}" -m "${newversion} release"
		${GIT} push origin --tags
		;;
	*)
		echo Current version: ${myversion}
		;;
esac
